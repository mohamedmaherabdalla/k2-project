#!/usr/bin/env bash
set -euo pipefail

ROOT="$(cd "$(dirname "$0")" && pwd)"

echo "python:"
"$ROOT/.venv/bin/python" -c "import fastapi,uvicorn; print('ok')"

echo "backend:"
if curl -fsS "http://127.0.0.1:8000/health" >/dev/null 2>&1; then
  echo "ok"
else
  echo "down"
  exit 1
fi

echo "frontend build:"
cd "$ROOT"
npm run build >/dev/null
echo "ok"

echo "extension compile:"
cd "$ROOT/extension"
npm run compile >/dev/null
echo "ok"
